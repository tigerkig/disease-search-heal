{% extends 'profile.html' %}

{% block overview %}
<!-- BEGIN PROFILE CONTENT -->
   <div class="profile-content">
      <div class="row">
         <div class="col-md-12">
            <div class="portlet light">
               <div class="portlet-title tabbable-line">
                  <div class="caption caption-md">
                     <i class="icon-globe theme-font hide"></i>
                     <span class="caption-subject font-blue-madison bold uppercase">Profile Account</span>
                  </div>
                  <ul class="nav nav-tabs">
                     <li class="active">
                        <a href="#tab_1_1" data-toggle="tab">Personal Info</a>
                     </li>
                     <li>
                        <a href="#tab_1_2" data-toggle="tab">Change Avatar</a>
                     </li>
                     <li>
                        <a href="#tab_1_3" data-toggle="tab">Change Password</a>
                     </li>
                     <li>
                        <a href="#tab_1_4" data-toggle="tab">Change Admin</a>
                     </li>
                  </ul>
               </div>
               <div class="portlet-body">
                  <div class="tab-content">
                     <!-- PERSONAL INFO TAB -->
                     <div class="tab-pane active" id="tab_1_1">
                        {% for info in profile %}
                        <div class="form-group">
                           <label class="control-label">First Name</label>
                           <input type="text" id="firstName" placeholder="John" class="form-control" value="{{info.firstName}}" />
                        </div>
                        <div class="form-group">
                           <label class="control-label">Last Name</label>
                           <input type="text" id="lastName" placeholder="Doe" class="form-control" value="{{info.lastName}}"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">Mobile Number</label>
                           <input type="text" id="moblieNumber" placeholder="+1 646 580 (6284)" class="form-control" value="{{info.moblieNumber}}"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">Interests</label>
                           <input type="text" id="interests" placeholder="Driving, boating etc." class="form-control" value="{{info.interests}}"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">Occupation</label>
                           <input type="text" id="occupation" placeholder="Your Occupation" class="form-control" value="{{info.occupation}}"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">About</label>
                           <textarea class="form-control" id="about" rows="3" placeholder="About Us">{{info.about}}</textarea>
                        </div>
                        <div class="form-group">
                           <label class="control-label">Website Url</label>
                           <input type="text" id="websiteURL" placeholder="http://www.mywebsite.com" class="form-control" value="{{info.websiteURL}}"/>
                        </div>
                        <div class="margiv-top-10" style="display: flex;justify-content: space-between;">
                           <div>
                              <input type="checkbox" id="Yes-No-profile-insert" class="make-switch" checked data-on-color="info" data-off-color="success" data-on-text="No" data-off-text="Yes"/>
                           </div>
                           <div>
                              <a href="javascript:;" id="Save_changes" class="btn green-haze">Save Changes </a>
                           </div>
                        </div>
                        {% endfor %}
                     </div>
                     <!-- END PERSONAL INFO TAB -->
                     <!-- CHANGE AVATAR TAB -->
                     <div class="tab-pane" id="tab_1_2">
                        <form id="id_ajax_upload_form" method="post" enctype="multipart/form-data" novalidate="">
                           {% csrf_token %}
                           <div>
                               <div class="form-group">
                                 <div class="fileinput fileinput-new" data-provides="fileinput" >
                                    <div class="fileinput-new thumbnail" style="width: 300px; height: 250px;">
                                       <img src="http://www.placehold.it/200x150/EFEFEF/AAAAAA&amp;text=no+image" alt="" style="width: 100%; height: 100%" />
                                    </div>
                                    <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 300px; max-height: 250px;">
                                    </div>
                                    <div style="display: flex;justify-content: space-between;">
                                       <span class="btn default btn-file">
                                          <span class="fileinput-new" style="padding: 96px">Select image </span>
                                          <span class="fileinput-exists">Change </span>
                                          <input type="file" name="image" accept="image/*">
                                       </span>
                                       <a href="javascript:;" class="btn default fileinput-exists" data-dismiss="fileinput">
                                       Remove </a>
                                    </div>
                                    <div class="margin-top-10">
                                       <button type="Submit" class="btn green-haze" id="profile_image" style="width: 100%">
                                       Submit </button>
                                    </div>
                                 </div>
                              </div>
                           </div>
                          
                        </form>
                     </div>
                     <!-- END CHANGE AVATAR TAB -->
                     <!-- CHANGE PASSWORD TAB -->
                     <div class="tab-pane" id="tab_1_3">
                        <div class="form-group">
                           <label class="control-label">Current Password</label>
                           <input type="password" id="Current_pwd" class="form-control"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">New Password</label>
                           <input type="password" id="newPwd" class="form-control"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">Re-type New Password</label>
                           <input type="password" id="rePwd" class="form-control"/>
                        </div>
                        <div class="margin-top-10" style="display: flex; justify-content: space-between;">
                           <div>
                              <input type="checkbox" id="Yes-No-change-password" class="make-switch" checked data-on-color="info" data-off-color="success" data-on-text="No" data-off-text="Yes"/>
                           </div>
                           <div>
                              <a href="javascript:;" id="reset" class="btn default">Clear </a>
                              <a href="javascript:;" id="changePwd" class="btn green-haze">Change Password </a>
                           </div>
                        </div>
                     </div>
                     <!-- END CHANGE PASSWORD TAB -->
                     <!-- CHANGE PASSWORD TAB -->
                     <div class="tab-pane" id="tab_1_4">
                        <div class="form-group">
                           <label class="control-label">Current Email</label>
                           <input type="email" id="Current_email" class="form-control"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">New AdminName</label>
                           <input type="text" id="adminName" class="form-control"/>
                        </div>
                        <div class="form-group">
                           <label class="control-label">New Email</label>
                           <input type="text" id="newEmail" class="form-control"/>
                        </div>
                        <div class="margin-top-10" style="display: flex; justify-content: space-between;">
                           <div>
                              <input type="checkbox" id="Yes-No-change-admin" class="make-switch" checked data-on-color="info" data-off-color="success" data-on-text="No" data-off-text="Yes"/>
                           </div>
                           <div>
                              <a href="javascript:;" id="admin_reset" class="btn default">Clear </a>
                              <a href="javascript:;" id="admin_change" class="btn green-haze">Change Info </a>
                           </div>
                        </div>
                     </div>
                     <!-- END CHANGE PASSWORD TAB -->
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!-- END PROFILE CONTENT -->
<script src="../static/global/plugins/jquery.min.js" type="text/javascript"></script>

<script>
   $(document).ready(function () {
      $('#account').addClass('active');
      $('#overview').removeClass('active');

      $('#Save_changes').click(function(){
         if($('#firstName').val() == '' || $('#lastName').val() == '' || $('#moblieNumber').val() == '' || $('#websiteURL').val() == '' || $('#occupation').val() == '') {
            toastr.error("Please insert data.", "Information")
         } else {
            if($('#Yes-No-profile-insert').is(':checked') == false) {
               $.post(
                  "insert_profile/",
                  {
                     csrfmiddlewaretoken : $('#token').val(),
                     firstName : $('#firstName').val(),
                     lastName : $('#lastName').val(),
                     moblieNumber : $('#moblieNumber').val(),
                     interests : $('#interests').val(),
                     occupation : $('#occupation').val(),
                     about : $('#about').val(),
                     websiteURL : $('#websiteURL').val()
                  },
                  function(response) {
                     if(response['instance'] == 'success') {
                        toastr.success("Successful update data","Information")
                        setTimeout(() => {  location.href="/admin/profile"; }, 500);
                     }
                  })
            } else {
               toastr.error("You must agree with YES", "Information")
            }
         }
         
      })

      $('#id_ajax_upload_form').submit(function(e){
           e.preventDefault();
           $form = $(this)
           var formData = new FormData(this);
           $.ajax({
               url: 'image_upload/',
               type: 'POST',
               data: formData,
               success: function (response) {
                   if(response['instance'] == 'success'){
                     toastr.success("Successful update data","Information")
                     setTimeout(() => {  location.reload(); }, 500);
                   }
                   else{
                       
                   }
               },
               cache: false,
               contentType: false,
               processData: false
           });
      });  

      $('#changePwd').click(function(){
         if($('#rePwd').val() == '' || $('#newPwd').val() == '' || $('#Current_pwd').val() == ''){
            toastr.error("Please insert all data !","Information")
         } else {
            if($('#Yes-No-change-password').is(':checked') == false) {
               $.post(
                  "change_password/",
                  {
                     csrfmiddlewaretoken : $('#token').val(),
                     current_pwd : $('#Current_pwd').val(),
                     rePwd : $('#rePwd').val(),
                     newPwd : $('#newPwd').val()
                  },
                  function(response) {
                     if(response['instance'] == 'success') {
                        toastr.success("Successful update data","Information")
                        setTimeout(() => {  location.href="/admin/profile"; }, 500);
                     } else if (response['instance'] == 'error') {
                        toastr.error("Incorrect Password","Information")
                     } else {
                        toastr.error(response['instance'],"Information")
                     }
                  })
            } else {
               toastr.error("You must agree with YES", "Information")
            }
            
         }
      })

      $('#admin_change').click(function(){
         if($('#Current_email').val() == '' || $('#adminName').val() == '' || $('#newEmail').val() == ''){
            toastr.error("Please insert all data !","Information")
         } else {
            if($('#Yes-No-change-admin').is(':checked') == false) {
               if(IsEmail($('#Current_email').val()) == true || IsEmail($('#newEmail').val()) == true) {
                  $.post(
                     "change_admin/",
                     {
                        csrfmiddlewaretoken : $('#token').val(),
                        Current_email : $('#Current_email').val(),
                        newEmail : $('#newEmail').val(),
                        adminName : $('#adminName').val()
                     },
                     function(response) {
                        if(response['instance'] == 'success') {
                           toastr.success("Successful update data","Information")
                           setTimeout(() => {  location.href="/admin/profile"; }, 500);
                        } else if (response['instance'] == 'error') {
                           toastr.error("Incorrect Password","Information")
                        } else {
                           toastr.error(response['instance'],"Information")
                        }
                     })
               } else {
                  toastr.warning("Incorrect email type.", "Information")
               }
               
            } else {
               toastr.error("You must agree with YES", "Information")
            }
            
         }
      })

      $('#reset').click(function(){
         $('#Current_pwd').val('');
         $('#rePwd').val('');
         $('#newPwd').val('');
      })

      $('#admin_reset').click(function(){
         $('#Current_email').val('');
         $('#adminName').val('');
         $('#newEmail').val('');
      })

   });    

   function IsEmail(email) {
      var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      if(!regex.test(email)) {
         return false;
      }else{
        return true;
      }
   }   
</script>  
{% endblock %}